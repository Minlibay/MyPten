# Генерация и настройка талантов

## Обзор готового каталога

Скриптовая система талантов теперь включает 100 узлов, сгруппированных в 11 тематических цепочек:

| Цепочка | Тип таланта | Краткое описание | Количество узлов |
| --- | --- | --- | --- |
| Живучесть | `MaxHP` | Бонус к максимальному здоровью и защите фронтлайна | 10 |
| Берсерк | `Damage` | Прирост базового урона и усиление ближних атак | 10 |
| Процветание | `GoldGain` | Дополнительное золото из всех источников | 10 |
| Удача | `ItemDropChance` | Рост шанса выпадения трофеев и материалов | 10 |
| Купец | `VendorDiscount` | Скидки у торговцев и улучшенные сделки | 10 |
| Разведчик | `MoveSpeed` | Бонусы к скорости перемещения и уклонению | 10 |
| Мощь | `Strength` | Прирост Силы, влияющий на здоровье и урон | 10 |
| Ловкость | `Dexterity` | Прирост Ловкости, дающий скорость атаки и крит. шанс | 10 |
| Мудрость | `Intelligence` | Прирост Интеллекта для способностей и КД | 10 |
| Темп | `AttackSpeed` | Ускорение атак по процентной шкале | 5 |
| Фокус | `CooldownReduction` | Сокращение времени восстановления умений | 5 |

Цепочки построены с последовательными требованиями: чтобы открыть следующий узел, необходимо прокачать предыдущий до указанного ранга. Все 100 талантов собраны в дереве `Resources/Talents/CompleteTree.asset`, которое автоматически подхватывается `TalentService` и интерфейсом талантов.

## Структура данных

Исходная информация хранится в CSV-файле `docs/data/talents.csv` с разделителем `;`. Формат колонок:

1. `id` — уникальный идентификатор узла (используется в зависимостях и сохранениях).
2. `title` — отображаемое название.
3. `description` — текст описания (можно оставлять пустым, чтобы показать автогенерируемую подпись).
4. `type` — значение перечисления `TalentType` (точное совпадение по имени).
5. `maxRank` — максимальный ранг узла (целое число).
6. `values` — список значений бонуса на каждом ранге, разделённых вертикальной чертой `|`.
7. `requirements` — пары `id:ранг`, разделённые `|`. Оставьте поле пустым, если зависимостей нет.

Файл можно редактировать в любом табличном редакторе, сохраняя кодировку UTF-8 без BOM.

## Инструмент генерации в редакторе

В меню Unity доступно окно **Tools → Talents → Batch Generator**, реализованное в `Editor/TalentBatchGeneratorWindow.cs`. Оно позволяет:

1. Выбрать CSV-файл с описанием талантов (по умолчанию подхватывается `Assets/docs/data/talents.csv`).
2. Задать папку, куда будут записаны отдельные `TalentNode` (`Assets/Resources/Talents/Expanded` по умолчанию).
3. Указать путь для дерева (`Assets/Resources/Talents/CompleteTree.asset`).
4. Нажать **Generate/Update Assets**, чтобы пересоздать ScriptableObject'ы и обновить дерево.

При генерации окно:

- Создаёт или обновляет по одному `TalentNode` на строку CSV.
- Перезаписывает значения рангов, описания и зависимости.
- Строит `TalentTree`, упорядоченный так же, как строки в CSV.
- Сохраняет изменения и обновляет AssetDatabase.

Это означает, что для добавления новых талантов достаточно:

1. Добавить строки в `docs/data/talents.csv` (или другой указанный CSV).
2. Открыть окно генерации и нажать **Generate/Update Assets**.
3. При необходимости скорректировать ссылки в сценах/UI, если используется альтернативное дерево.

## Советы по расширению

- Используйте отдельные CSV-файлы для экспериментов — окно позволяет выбрать любой `TextAsset` в проекте.
- Значения можно задавать как целые, так и дробные числа (через точку). Они автоматически конвертируются в `float`.
- Требования удобнее строить линейно (`предыдущий узел -> следующий`), но формат позволяет создавать развилки.
- После изменений перезапустите сцену или повторно откройте вкладку талантов, чтобы увидеть обновлённый список.

## Связанные файлы

- `Scripts/UI/TalentsUI.cs` — подхватывает дерево и строит список узлов в UI.
- `Scripts/Talents/TalentService.cs` — агрегирует бонусы по типам.
- `Scripts/Player/PlayerStatService.cs` — применяет бонусы к боевым характеристикам.

