# Анализ проекта и дорожная карта развития

## 1. Обзор текущих подсистем
- **Старт приложения и профили.** `GameManager` хранит активный профиль и выбранный класс в синглтоне, а `BootLoader` по состоянию сохранения отправляет игрока либо в создание персонажа, либо в хаб-сцену.
- **Модель данных профиля.** `PlayerProfile` сериализует валюту, опыт, очки талантов, инвентарь и экипировку в `PlayerPrefs` в рамках одного слота `begin_profile`.
- **Прогресс и таланты.** `ProgressService` считает уровень и опыт, а `TalentService` управляет распределением очков, проверкой требований и расчетом суммарных бонусов для боевых статов.
- **Экономика и инвентарь.** `Currency`, `InventoryService` и `Vendor` обеспечивают хранение золота, список предметов и генерацию ассортимента с учетом талантов. UI-слой (`InventoryUIV2`, `VendorUI`, `TalentsUI`) напрямую модифицирует эти сервисы.
- **Хаб и мета-цикл.** `HubUI` переключает панели, запускает бой и возвращает игрока после победы. `CharacterCreationUI` создает стартовый профиль при первом запуске.
- **Бой.** `BattleManager` программно собирает сцену (карту, игрока, HUD, спавнер волн) и по завершении боя грузит хаб. `WaveSpawner` читает `WaveTable`, пулит врагов и награждает игрока через `EnemyLoot`. Игрок атакует единственной способностью `SimpleAttack`.

## 2. Ключевые проблемы и возможности роста
1. **Сборка боя только кодом.** Невозможно удобно редактировать расстановку, подключать готовые префабы и передавать работу левел-дизайнеру.
2. **Один слот сохранения.** Нет выбора, резервного копирования и управления персонажами.
3. **Статы классов не используются.** STR/DEX/INT не влияют на механику, что уменьшает различия классов.
4. **Боевой геймплей минимален.** Только ближняя атака по пробелу, нет кулдаунов, ресурсов, обратной связи.
5. **Отсутствие экранов результатов.** Победа/поражение мгновенно возвращают в хаб без суммирования наград.
6. **Волны врагов статичны.** Нет усложнения, вариативности точек спавна и модификаторов.
7. **Инвентарь без метаданных.** Нет стакования, слотов, превью предметов, событий для частичного обновления UI.
8. **Слабая визуализация прогресса.** Игрок не видит суммарные бонусы и цели в хабе.
9. **Отсутствие автоматических проверок.** Любое изменение сервисов легко ломает сохранения и экономику.

## 3. Дорожная карта
### Этап 1. Подготовка инфраструктуры и UX ядра (2–3 спринта)
**Цели:** сделать цикл «хаб → бой → хаб» предсказуемым и расширяемым.

| Задача | Ключевые действия | Результат | Критерии приемки |
| --- | --- | --- | --- |
| 1. Префабы и сцена боя | Вынести игрока, HUD, карту, точки спавна в сериализуемые поля, разбить `BattleManager` на конфиг и контроллер, внедрить авторские маркеры спавна | Сцена собирается через инспектор, дизайнер может менять состав без кода | Бой стартует из хаба, все сущности берутся из инспектора, без регресса по наградам |
| 2. Экран завершения боя | Создать `RunResultService`, который копит опыт/золото/дроп, добавить UI экрана победы/поражения с кнопками «повтор» и «в хаб» | Игрок видит награды и может выбрать дальнейшее действие | После боя показывается экран, данные совпадают со значениями из сервисов |
| 3. Менеджер профилей | Расширить `PlayerProfile` до списка слотов (JSON в `PlayerPrefs` или файл), добавить экран выбора/создания/удаления | Можно иметь несколько персонажей и переключаться между ними | UI позволяет создать, переименовать и удалить слот, данные корректно сохраняются |
| 4. Мини-набор автотестов | Подготовить Edit/PlayMode тесты: загрузка/сохранение профиля, выдача талантов, покупка предметов, запуск волны | Автоматическая проверка основных сервисов | Тесты запускаются из CI, проходят локально |

### Этап 2. Углубление боя и прогрессии (3–4 спринта)
**Цели:** разнообразить выбор игрока и управлять ростом сложности.

| Задача | Ключевые действия | Результат | Критерии приемки |
| --- | --- | --- | --- |
| 1. Система способностей | Обобщить `SimpleAttack` до набора действий: база данных способностей, кулдауны, ресурсы, разные формы попадания, поддержка STR/DEX/INT | Классы отличаются набором навыков, есть как минимум 3 уникальные способности | Игрок может переключать/использовать способности, UI показывает кулдауны и стоимость |
| 2. Расширение врагов и волн | Добавить модификаторы сложности (скейлинг статов, аффиксы), сценарии спавна по точкам/паттернам, события волны | Повторы боёв ощущаются по-разному, есть рост сложности | Волны меняются от ранга/этапа, модификаторы влияют на поведение врагов |
| 3. Система наград | Расширить `EnemyLoot` и добавить таблицы редкости, пакеты ресурсов, дроп с параметрами; интегрировать с экраном результатов | Игрок получает разнообразные награды, есть прозрачные источники лута | Лут отображается в итоговом UI, дубли корректно стакуются |
| 4. Хаб-дашборд | Создать единый экран прогресса (уровень, золото, экипировка, бонусы талантов, активные задания) | Игрок видит развитие и ближайшие цели | Данные обновляются без перезагрузки сцен, UI реагирует на изменения сервисов |

### Этап 3. Ретеншн и подготовка к лайв-операциям (4+ спринтов)
**Цели:** повысить удержание и готовность к контентным обновлениям.

| Задача | Ключевые действия | Результат | Критерии приемки |
| --- | --- | --- | --- |
| 1. Квесты и кампании | Добавить систему задач/миссий, хранить прогресс в профиле, выводить задания в хабе и учитывать при наградах | Игрок получает цели помимо волн, контент можно ротировать | Квесты сохраняются, прогресс отображается в UI, награды добавляются к итогам боя |
| 2. Инструменты балансировки | Вынести экономику и таблицы дропа в `ScriptableObject`/CSV, подготовить редакторские окна для правок | Баланс корректируется без правок кода | Изменение данных в инструментах сразу влияет на игру, ревизии хранятся в репозитории |
| 3. Временные события | Создать систему «модификаторов недели», которая меняет волны/награды и записывает участие в профиль | Появляется повод возвращаться каждую неделю | Событие включается конфигом, прогресс сохраняется, UI сообщает о бонусах |
| 4. Телеметрия и аналитика | Встроить сбор данных о боях, талантах, покупках с опцией согласия; настроить экспорт | Команда видит реальные метрики и узкие места | События логируются в файл/внешний сервис, игрок может отключить сбор |

## 4. Быстрые победы (можно выполнять параллельно)
- Добавить короткий туториал в хабе (overlay с подсказками) без изменения основного цикла.
- Улучшить визуальную обратную связь: вспышки урона, всплывающие числа, звуки победы/поражения.
- Настроить сохранение настроек управления и громкости в профиле.

## 5. Следующие шаги
1. Утвердить дорожную карту и длительность спринтов с командой.
2. Оценить зависимости по ресурсам (UI/UX, 3D, сервер, аналитика).
3. Стартовать с Этапа 1, параллельно готовя дизайн-документы для системы способностей и наград.

Этот план отражает текущее состояние кода и предлагает последовательное расширение функциональности от стабилизации ядра до возможностей лайв-оперирования.
