# Настройка этапов и волн

Новая система `WaveStageSet` позволяет гибко управлять количеством волн на каждом этапе боя и порядком их появления.

## Основные шаги

1. Создайте (или продублируйте) ScriptableObject **WaveStageSet** через меню `Create → Begin → Waves → Stage Set`.
2. Укажите таблицу волн по умолчанию (`Default Wave Table`). Если поле пустое, будет использована таблица, назначенная у `WaveSpawner`.
3. Задайте параметры: `First Stage Wave Count`, `Wave Increment Per Stage`, `Include Boss By Default`, режим переполнения (`Default Overflow Mode`).
4. При необходимости добавьте элементы в список `Stage Overrides` — каждый элемент задаёт исключения для конкретного номера этапа (1 = первый этап).

## Параметры Stage Override

| Поле | Описание |
| --- | --- |
| `Stage Index` | Номер этапа (1, 2, 3 ...). |
| `Wave Table Override` | Замена таблицы волн только для выбранного этапа. |
| `Override Normal Wave Count` | Принудительно задать количество волн перед боссом. |
| `Override Include Boss` | Включить/выключить финального босса на этапе. |
| `Override Boss` и `Boss Override` | Заменить финального босса. |
| `Override Boss Support` | Настроить поддержку босса (список `WaveEntry`). Пустой список означает, что помощников не будет. |
| `Override Overflow Mode` | Использовать собственный режим переполнения (Clamp, Loop, Stop). |
| `Wave Sequence` | Последовательность индексов волн (0 = первая волна в таблице). Если список короче требуемого количества волн, применяется выбранный режим переполнения. |

## Как это работает в бою

`WaveSpawner` теперь умеет работать с `WaveStageSet`. Для каждого этапа строится план:

- количество обычных волн = `First Stage Wave Count` + `Wave Increment Per Stage` × (номер этапа − 1);
- порядок волн берётся из таблицы и/или `Wave Sequence`;
- последняя волна может включать босса и поддержку в зависимости от настроек.

`BattleManager` загружает пример конфигурации `Resources/Waves/SampleStageSet.asset`. Чтобы использовать свою настройку, создайте новый `WaveStageSet` и назначьте его в инспекторе у `WaveSpawner` (или замените ресурс).

## Советы

- Если таблица содержит меньше волн, чем требуется этапу, используйте режим `Loop` (повтор) или `Clamp` (последняя волна) для заполнения недостающих.
- Чтобы быстро отключить босса на этапе, добавьте `Stage Override` и снимите галочку `Include Boss`.
- Этапы продолжают работать даже если `stageOverrides` пуст — формула увеличивает количество волн на каждом шаге (6, затем 7, 8 и т.д.).
